<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Selector</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body>

<div class="flex p-1.5 border border-[#D2D2D2] rounded-md w-full flex-1 relative z-50">
    <div class="max-w-[120px] w-full flex items-center justify-between relative z-50">
        <div class="relative w-full mx-auto z-50">
            <div id="countryDropdown" class="flex cursor-pointer items-center justify-between w-full px-2 gap-1" onclick="toggleCountryOptions()">
                <div class="flex items-center font-sans gap-1">
                    <img src="https://flagcdn.com/w20/us.png" id="selectedFlag" class="h-5 object-cover " alt="US Flag">
                    <span id="selectedCountryCode">+1</span>
                </div>
                <svg class="w-4 h-4 text-gray-500" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.79079 8.00017L16.2108 8.00017C16.5432 7.99969 16.869 8.09336 17.1503 8.27033C17.4317 8.44731 17.6572 8.70035 17.8008 9.00017C17.9688 9.35592 18.0335 9.75171 17.9876 10.1424C17.9416 10.5332 17.7868 10.9031 17.5408 11.2102L13.3308 16.3102C13.1656 16.5008 12.9613 16.6537 12.7318 16.7585C12.5024 16.8633 12.253 16.9175 12.0008 16.9175C11.7485 16.9175 11.4992 16.8633 11.2697 16.7585C11.0403 16.6537 10.836 16.5008 10.6708 16.3102L6.46078 11.2102C6.21478 10.9031 6.05997 10.5332 6.014 10.1424C5.96803 9.75171 6.03275 9.35592 6.20079 9.00017C6.34433 8.70035 6.56984 8.44731 6.85123 8.27033C7.13262 8.09336 7.45837 7.99969 7.79079 8.00017Z" fill="#797979"/>
                </svg>
            </div>
        </div>
    </div>
    <ul id="countryOptions" class="absolute left-0 top-[34px] w-full mt-2 bg-[#fff] max-w-[249px] rounded-lg shadow-lg hidden z-50 max-h-[240px] overflow-y-auto font-sans">
        <li>
            <input type="text" id="countrySearch" placeholder="Search country..." class="w-full p-2 border border-[#D2D2D2] rounded-md" onkeyup="filterCountries()">
        </li>
        <!-- Country options will be populated here -->
    </ul>
    <input type="number" minlength="1" max="14" class="border-l border-[#D2D2D2] flex-1 px-4 py-1 text-[#797979] font-sans outline-none z-50 relative" required placeholder="Phone Number" name="" id="phoneNumber">
</div>

<script>
async function fetchCountries() {
    const response = await fetch('https://restcountries.com/v3.1/all');
    const countries = await response.json();
    return countries;
}

async function initCountryDropdown() {
    const countries = await fetchCountries();
    const countryOptions = document.getElementById('countryOptions');

    // Clear existing options
    countryOptions.innerHTML = `
        <li>
            <input type="text" id="countrySearch" placeholder="Search country..." class="w-full p-2 border border-[#D2D2D2] rounded-md" onkeyup="filterCountries()">
        </li>
    `;

    // Sort countries alphabetically
    countries.sort((a, b) => a.name.common.localeCompare(b.name.common));

    countries.forEach(country => {
        const callingCode = country.idd && country.idd.root && country.idd.suffixes 
            ? `${country.idd.root}${country.idd.suffixes[0]}` 
            : 'N/A';

        const li = document.createElement('li');
        li.className = 'flex items-center px-4 py-2 cursor-pointer hover:bg-gray-100';
        li.onclick = () => selectCountry(country.name.common, country.flags.png, callingCode);

        const flagImg = document.createElement('img');
        flagImg.src = country.flags.png;
        flagImg.className = 'w-5 h-5 mr-2';
        flagImg.alt = `${country.name.common} Flag`;

        const countryText = document.createTextNode(` ${country.name.common} (${callingCode})`);

        li.appendChild(flagImg);
        li.appendChild(countryText);

        countryOptions.appendChild(li);
    });

    // Automatically select UAE as the default option
    const uaeCountry = countries.find(country => country.name.common === "United Arab Emirates");
    if (uaeCountry) {
        const callingCode = uaeCountry.idd && uaeCountry.idd.root && uaeCountry.idd.suffixes 
            ? `${uaeCountry.idd.root}${uaeCountry.idd.suffixes[0]}` 
            : 'N/A';
        selectCountry(uaeCountry.name.common, uaeCountry.flags.png, callingCode);
    }

    // Close the dropdown by default
    countryOptions.classList.add('hidden');
}

function selectCountry(name, flag, code) {
    document.getElementById('selectedFlag').src = flag;
    document.getElementById('selectedCountryCode').textContent = code;
    toggleCountryOptions();
}

// Toggle dropdown visibility
function toggleCountryOptions() {
    const options = document.getElementById('countryOptions');
    options.classList.toggle('hidden');
}

// Close the dropdown when clicking outside
document.addEventListener('click', function (e) {
    const dropdown = document.getElementById('countryOptions');
    const inputField = document.getElementById('countryDropdown');

    // Check if the click was outside the dropdown and the input field
    if (!dropdown.contains(e.target) && e.target !== inputField) {
        dropdown.classList.add('hidden');
    }
});

// Filter countries based on search input
function filterCountries() {
    const input = document.getElementById('countrySearch').value.toLowerCase();
    const options = document.getElementById('countryOptions');
    const liItems = options.getElementsByTagName('li');

    Array.from(liItems).forEach((li, index) => {
        if (index > 0) { // Skip the search input
            const countryName = li.textContent.toLowerCase();
            li.style.display = countryName.includes(input) ? '' : 'none';
        }
    });
}

// Add an event listener to the phone number input
document.getElementById('phoneNumber').addEventListener('input', function(e) {
    // Allow only numbers and restrict input length to 14 characters
    this.value = this.value.replace(/[^0-9]/g, '').slice(0, 14);
});

window.onload = initCountryDropdown;
</script>

</body>
</html>
